<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏∏‡∏°‡∏ó‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Kanit', sans-serif;
        }
        .edited-row {
            background-color: #dcfce7 !important;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-full">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-8 border border-indigo-100">
            <div class="flex flex-col items-center">
                <img src="https://img2.pic.in.th/pic/-2550a9c41e64e2eb.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏∏‡∏°‡∏ó‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤" class="w-20 h-20 mb-4 object-contain">
                <h1 class="text-4xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 bg-clip-text text-transparent text-center mb-3">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
                <p class="text-center text-gray-600 font-medium">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏∏‡∏°‡∏ó‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</p>
                <p class="text-center text-gray-500 text-sm mt-1">‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ ‡∏Ñ‡∏£‡∏π‡∏ô‡∏ô‡∏ó‡∏û‡∏±‡∏ó‡∏ò‡πå ‡∏´‡∏¥‡∏£‡∏±‡∏ç‡πÄ‡∏£‡∏∑‡∏≠‡∏á ‡∏á‡∏≤‡∏ô‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÇ‡∏≠‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-8 border border-indigo-100">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="searchName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•" 
                           class="w-full px-4 py-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</label>
                    <input type="text" id="searchSubject" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤" 
                           class="w-full px-4 py-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                    <select id="filterYear" class="w-full px-4 py-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                    <select id="filterSemester" class="w-full px-4 py-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    </select>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                    <select id="filterGradeStatus" class="w-full px-4 py-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                        <option value="0">0</option>
                        <option value="‡∏£">‡∏£</option>
                        <option value="‡∏°‡∏™">‡∏°‡∏™</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</label>
                    <select id="filterStatus" class="w-full px-4 py-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</option>
                    </select>
                </div>
            </div>
            <div class="flex justify-between items-center">
                <button onclick="searchData()" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-8 py-3 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105">
                    üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
                <button onclick="loadData()" class="bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white px-8 py-3 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105">
                    üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                </button>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-indigo-100">
            <div class="p-6 bg-gradient-to-r from-indigo-50 to-purple-50 border-b border-indigo-100">
                <h2 class="text-2xl font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</h2>
                <p class="text-sm text-gray-600 mt-2">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: 0, ‡∏£, ‡∏°‡∏™</p>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
                        <tr>
                            <th class="px-4 py-3 text-left">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th class="px-4 py-3 text-left">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</th>
                            <th class="px-4 py-3 text-left">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                            <th class="px-4 py-3 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                            <th class="px-4 py-3 text-left">‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</th>
                            <th class="px-4 py-3 text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</th>
                            <th class="px-4 py-3 text-left">‡∏ä‡∏±‡πâ‡∏ô</th>
                            <th class="px-4 py-3 text-left">‡∏ú‡∏•‡πÄ‡∏î‡∏¥‡∏°</th>
                            <th class="px-4 py-3 text-left">‡∏ú‡∏•‡πÉ‡∏´‡∏°‡πà</th>
                            <th class="px-4 py-3 text-center">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable">
                        <tr>
                            <td colspan="10" class="px-4 py-8 text-center text-gray-500">
                                <div class="loading mx-auto mb-2"></div>
                                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="px-6 py-4 bg-gradient-to-r from-indigo-50 to-purple-50 border-t border-indigo-100 flex items-center justify-between">
                <div class="text-sm text-gray-700">
                    ‡πÅ‡∏™‡∏î‡∏á <span id="showingFrom">0</span> - <span id="showingTo">0</span> ‡∏à‡∏≤‡∏Å <span id="totalRecords">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </div>
                <div class="flex space-x-2">
                    <button onclick="previousPage()" id="prevBtn" class="px-4 py-2 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200" disabled>
                        ‚Üê ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                    </button>
                    <span id="pageInfo" class="px-4 py-2 text-gray-700 font-medium">‡∏´‡∏ô‡πâ‡∏≤ 1</span>
                    <button onclick="nextPage()" id="nextBtn" class="px-4 py-2 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200" disabled>
                        ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-full overflow-y-auto">
            <div class="p-6 border-b">
                <h3 class="text-xl font-semibold text-gray-800">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <div class="mt-3 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg">
                    <p class="text-sm text-blue-800">
                        üìã <strong>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:</strong> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏Ñ‡∏£‡∏π‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô/‡∏ß‡∏±‡∏î‡∏ú‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏Ø‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö
                    </p>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <p id="editStudentName" class="text-gray-900 font-medium"></p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏±‡πâ‡∏ô</label>
                        <p id="editClass" class="text-gray-900"></p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <p id="editSubjectCode" class="text-gray-900"></p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <p id="editSubjectName" class="text-gray-900"></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏¥‡∏°</label>
                        <p id="editOldResult" class="text-red-600 font-bold text-lg"></p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà *</label>
                        <select id="editNewResult" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="1.5">1.5</option>
                            <option value="2">2</option>
                            <option value="2.5">2.5</option>
                            <option value="3">3</option>
                            <option value="3.5">3.5</option>
                            <option value="4">4</option>
                            <option value="‡∏£">‡∏£</option>
                            <option value="‡∏°‡∏™">‡∏°‡∏™</option>
                        </select>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏π‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç *</label>
                    <input type="text" id="editEditor" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏î‡∏µ‡πÉ‡∏à" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>

                <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ *</label>
                    <input type="password" id="editPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 4 ‡∏´‡∏•‡∏±‡∏Å" 
                           maxlength="4" pattern="[0-9]{4}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <p class="text-xs text-red-500 mt-1">üîí ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏£‡∏π‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ</p>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</label>
                    <input type="file" id="editImageFile" accept=".jpg,.jpeg,.png,.pdf" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: JPG, PNG, PDF (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)</p>
                </div>
            </div>
            <div class="px-6 py-4 bg-gray-50 border-t flex justify-end space-x-3">
                <button onclick="closeEditModal()" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-md">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
                <button onclick="saveEdit()" id="saveBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                </button>
            </div>
        </div>
    </div>

    <!-- Log Modal -->
    <div id="logModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-full overflow-y-auto">
            <div class="p-6 border-b">
                <h3 class="text-xl font-semibold text-gray-800">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</h3>
            </div>
            <div class="p-6">
                <div id="logContent" class="space-y-4">
                    <div class="text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                </div>
            </div>
            <div class="px-6 py-4 bg-gray-50 border-t flex justify-end">
                <button onclick="closeLogModal()" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-md">
                    ‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            APP_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbynM3jhKBptP9JoDMH0c8CWHqADwj-yV7g3tScby6beJpSgJKsAnyIrkQZNo0gKN_yTEg/exec',
            RECORDS_PER_PAGE: 20
        };

        // Global variables
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        let currentEditRow = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });

        // Load data from Google Sheets
        async function loadData() {
            try {
                showLoading();
                const url = CONFIG.APP_SCRIPT_URL + '?action=getData&t=' + new Date().getTime();
                console.log('Attempting to fetch data from:', url);
                
                // Try to fetch data with proper error handling
                const response = await fetch(url, {
                    method: 'GET',
                    redirect: 'follow'
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                // Check if response is ok
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Response data:', result);
                
                if (result.success && result.data && result.data.length > 0) {
                    allData = result.data;
                    console.log('Loaded data count:', allData.length);
                    
                    // Filter only failed grades (0, ‡∏£, ‡∏°‡∏™)
                    filteredData = allData.filter(row => 
                        String(row.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || '').trim() === '0' || 
                        String(row.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || '').trim() === '‡∏£' || 
                        String(row.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || '').trim() === '‡∏°‡∏™'
                    );
                    
                    console.log('Filtered data count:', filteredData.length);
                    
                    populateFilters();
                    displayData();
                    
                    // Show success message
                    if (filteredData.length > 0) {
                        setTimeout(() => {
                            alert(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\n‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô: ${filteredData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                        }, 500);
                    }
                } else {
                    console.log('No data or unsuccessful response, loading sample data');
                    loadSampleData();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                console.log('Network error or CORS issue, loading sample data for testing...');
                
                // Show error details
                showError(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡πÑ‡∏î‡πâ: ${error.message}`);
                
                // Load sample data after showing error
                setTimeout(() => {
                    loadSampleData();
                }, 2000);
            }
        }

        // Load sample data for testing when Google Sheets is not available
        function loadSampleData() {
            allData = [
                {
                    rowIndex: 2,
                    ‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ: '2567',
                    ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢',
                    ‡∏ä‡∏∑‡πà‡∏≠: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢',
                    ‡∏™‡∏Å‡∏∏‡∏•: '‡πÉ‡∏à‡∏î‡∏µ',
                    ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤: 'TH101',
                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤: '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢',
                    '‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤': '1/2567',
                    ‡∏ä‡∏±‡πâ‡∏ô: '‡∏°.1/1',
                    ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: '45',
                    ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: '0',
                    New_Result: '',
                    Correction_Status: '',
                    Editor: '',
                    EditDate: '',
                    EditTime: '',
                    Log_Link: ''
                },
                {
                    rowIndex: 3,
                    ‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ: '2567',
                    ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á',
                    ‡∏ä‡∏∑‡πà‡∏≠: '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á',
                    ‡∏™‡∏Å‡∏∏‡∏•: '‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
                    ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤: 'EN102',
                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤: '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©',
                    '‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤': '1/2567',
                    ‡∏ä‡∏±‡πâ‡∏ô: '‡∏°.1/2',
                    ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: '0',
                    ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: '‡∏£',
                    New_Result: '',
                    Correction_Status: '',
                    Editor: '',
                    EditDate: '',
                    EditTime: '',
                    Log_Link: ''
                },
                {
                    rowIndex: 4,
                    ‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ: '2567',
                    ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤: '‡∏ô‡∏≤‡∏¢',
                    ‡∏ä‡∏∑‡πà‡∏≠: '‡∏ß‡∏¥‡∏ä‡∏±‡∏¢',
                    ‡∏™‡∏Å‡∏∏‡∏•: '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å',
                    ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤: 'MA103',
                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤: '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                    '‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤': '1/2567',
                    ‡∏ä‡∏±‡πâ‡∏ô: '‡∏°.2/1',
                    ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: '0',
                    ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: '‡∏°‡∏™',
                    New_Result: '2.5',
                    Correction_Status: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß',
                    Editor: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏î‡∏µ‡πÉ‡∏à',
                    EditDate: '15/12/2567',
                    EditTime: '14:30:25',
                    Log_Link: ''
                },
                {
                    rowIndex: 5,
                    ‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ: '2567',
                    ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß',
                    ‡∏ä‡∏∑‡πà‡∏≠: '‡∏°‡∏≤‡∏•‡∏µ',
                    ‡∏™‡∏Å‡∏∏‡∏•: '‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°',
                    ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤: 'SC104',
                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤: '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                    '‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤': '1/2567',
                    ‡∏ä‡∏±‡πâ‡∏ô: '‡∏°.3/1',
                    ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: '35',
                    ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: '0',
                    New_Result: '',
                    Correction_Status: '',
                    Editor: '',
                    EditDate: '',
                    EditTime: '',
                    Log_Link: ''
                },
                {
                    rowIndex: 6,
                    ‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ: '2567',
                    ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢',
                    ‡∏ä‡∏∑‡πà‡∏≠: '‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå',
                    ‡∏™‡∏Å‡∏∏‡∏•: '‡∏Ç‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
                    ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤: 'SO105',
                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤: '‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤',
                    '‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤': '2/2567',
                    ‡∏ä‡∏±‡πâ‡∏ô: '‡∏°.1/3',
                    ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: '0',
                    ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: '0',
                    New_Result: '1.5',
                    Correction_Status: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß',
                    Editor: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ',
                    EditDate: '16/12/2567',
                    EditTime: '09:15:42',
                    Log_Link: ''
                }
            ];

            // Filter only failed grades (0, ‡∏£, ‡∏°‡∏™)
            filteredData = allData.filter(row => 
                String(row.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || '').trim() === '0' || 
                String(row.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || '').trim() === '‡∏£' || 
                String(row.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || '').trim() === '‡∏°‡∏™'
            );
            
            populateFilters();
            displayData();
            
            // Show info message
            setTimeout(() => {
                alert('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡πÑ‡∏î‡πâ\n\n‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\n1. URL ‡∏Ç‡∏≠‡∏á Google Apps Script\n2. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CORS\n3. ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Google Sheets');
            }, 1000);
        }

        // Populate filter options
        function populateFilters() {
            const yearFilter = document.getElementById('filterYear');
            const semesterFilter = document.getElementById('filterSemester');
            
            // Populate year filter
            const years = [...new Set(filteredData.map(row => row.‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ))].sort();
            yearFilter.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option>';
            years.forEach(year => {
                yearFilter.innerHTML += `<option value="${year}">${year}</option>`;
            });
            
            // Populate semester filter
            const semesters = [...new Set(filteredData.map(row => row['‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤']))].sort();
            semesterFilter.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>';
            semesters.forEach(semester => {
                semesterFilter.innerHTML += `<option value="${semester}">${semester}</option>`;
            });
        }

        // Search and filter data
        function searchData() {
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const searchSubject = document.getElementById('searchSubject').value.toLowerCase();
            const filterYear = document.getElementById('filterYear').value;
            const filterSemester = document.getElementById('filterSemester').value;
            const filterGradeStatus = document.getElementById('filterGradeStatus').value;
            const filterStatus = document.getElementById('filterStatus').value;

            filteredData = allData.filter(row => {
                // Only show failed grades
                const grade = String(row.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || '').trim();
                if (!(grade === '0' || grade === '‡∏£' || grade === '‡∏°‡∏™')) {
                    return false;
                }

                const fullName = `${row.‡∏ä‡∏∑‡πà‡∏≠} ${row.‡∏™‡∏Å‡∏∏‡∏•}`.toLowerCase();
                const matchName = !searchName || fullName.includes(searchName);
                const matchSubject = !searchSubject || row.‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤.toLowerCase().includes(searchSubject);
                const matchYear = !filterYear || row.‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ === filterYear;
                const matchSemester = !filterSemester || row['‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤'] === filterSemester;
                const matchGradeStatus = !filterGradeStatus || grade === filterGradeStatus;
                const matchStatus = filterStatus === '' || 
                    (filterStatus === '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß' && row.Correction_Status === '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß') ||
                    (filterStatus === '' && row.Correction_Status !== '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß');

                return matchName && matchSubject && matchYear && matchSemester && matchGradeStatus && matchStatus;
            });

            currentPage = 1;
            displayData();
        }

        // Display data in table
        function displayData() {
            const tableBody = document.getElementById('dataTable');
            const startIndex = (currentPage - 1) * CONFIG.RECORDS_PER_PAGE;
            const endIndex = startIndex + CONFIG.RECORDS_PER_PAGE;
            const pageData = filteredData.slice(startIndex, endIndex);

            if (pageData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="10" class="px-4 py-8 text-center text-gray-500">
                            ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                        </td>
                    </tr>
                `;
            } else {
                tableBody.innerHTML = pageData.map((row, index) => {
                    const isEdited = row.Correction_Status === '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß';
                    const rowClass = isEdited ? 'edited-row' : '';
                    const statusIcon = isEdited ? '‚úì' : '';
                    const logIcon = isEdited ? 'üìã' : '';
                    
                    return `
                        <tr class="${rowClass}">
                            <td class="px-4 py-3">
                                <span class="text-green-600 font-bold">${statusIcon}</span>
                                ${isEdited ? `<button onclick="viewLog(${startIndex + index})" class="ml-2 text-blue-600 hover:text-blue-800" title="‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">${logIcon}</button>` : ''}
                            </td>
                            <td class="px-4 py-3">${row.‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ || ''}</td>
                            <td class="px-4 py-3">${row['‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤'] || ''}</td>
                            <td class="px-4 py-3">${row.‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ || ''} ${row.‡∏ä‡∏∑‡πà‡∏≠ || ''} ${row.‡∏™‡∏Å‡∏∏‡∏• || ''}</td>
                            <td class="px-4 py-3">${row.‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤ || ''}</td>
                            <td class="px-4 py-3">${row.‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ || ''}</td>
                            <td class="px-4 py-3">${row.‡∏ä‡∏±‡πâ‡∏ô || ''}</td>
                            <td class="px-4 py-3">
                                <span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm font-medium">${row.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || ''}</span>
                            </td>
                            <td class="px-4 py-3">
                                ${row.New_Result ? `<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-medium">${row.New_Result}</span>` : '-'}
                            </td>
                            <td class="px-4 py-3 text-center">
                                <button onclick="editRecord(${startIndex + index})" class="bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105">
                                    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            updatePagination();
        }

        // Update pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / CONFIG.RECORDS_PER_PAGE);
            const startIndex = (currentPage - 1) * CONFIG.RECORDS_PER_PAGE;
            const endIndex = Math.min(startIndex + CONFIG.RECORDS_PER_PAGE, filteredData.length);

            document.getElementById('showingFrom').textContent = filteredData.length > 0 ? startIndex + 1 : 0;
            document.getElementById('showingTo').textContent = endIndex;
            document.getElementById('totalRecords').textContent = filteredData.length;
            document.getElementById('pageInfo').textContent = `‡∏´‡∏ô‡πâ‡∏≤ ${currentPage} ‡∏à‡∏≤‡∏Å ${totalPages}`;

            document.getElementById('prevBtn').disabled = currentPage <= 1;
            document.getElementById('nextBtn').disabled = currentPage >= totalPages;
        }

        // Pagination functions
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                displayData();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredData.length / CONFIG.RECORDS_PER_PAGE);
            if (currentPage < totalPages) {
                currentPage++;
                displayData();
            }
        }

        // Edit record
        function editRecord(index) {
            currentEditRow = index;
            const record = filteredData[index];
            
            document.getElementById('editStudentName').textContent = `${record.‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ || ''} ${record.‡∏ä‡∏∑‡πà‡∏≠ || ''} ${record.‡∏™‡∏Å‡∏∏‡∏• || ''}`;
            document.getElementById('editClass').textContent = record.‡∏ä‡∏±‡πâ‡∏ô || '';
            document.getElementById('editSubjectCode').textContent = record.‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤ || '';
            document.getElementById('editSubjectName').textContent = record.‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ || '';
            document.getElementById('editOldResult').textContent = record.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || '';
            document.getElementById('editNewResult').value = record.New_Result || '';
            document.getElementById('editEditor').value = '';
            document.getElementById('editImageFile').value = '';
            document.getElementById('editPassword').value = ''; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ

            document.getElementById('editModal').classList.add('show');
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            currentEditRow = null;
        }

        // Save edit
        async function saveEdit() {
            const newResult = document.getElementById('editNewResult').value;
            const editor = document.getElementById('editEditor').value;
            const password = document.getElementById('editPassword').value;
            const imageFile = document.getElementById('editImageFile').files[0];

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!newResult || !editor || !password) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô\n\n- ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà\n- ‡∏ú‡∏π‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç\n- ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£');
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™ 4 ‡∏´‡∏•‡∏±‡∏Å)
            const CORRECT_PASSWORD = '1234'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
            
            if (password !== CORRECT_PASSWORD) {
                alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
                // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏ú‡∏¥‡∏î
                document.getElementById('editPassword').value = '';
                document.getElementById('editPassword').focus();
                return;
            }

            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<div class="loading mr-2"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            try {
                const record = filteredData[currentEditRow];
                
                // Create comprehensive update data
                const updateData = {
                    action: 'updateRecord',
                    rowIndex: record.rowIndex,
                    studentName: `${record.‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ || ''} ${record.‡∏ä‡∏∑‡πà‡∏≠ || ''} ${record.‡∏™‡∏Å‡∏∏‡∏• || ''}`.trim(),
                    subjectCode: record.‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤ || '',
                    subjectName: record.‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ || '',
                    oldResult: record.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || '',
                    newResult: newResult,
                    editor: editor,
                    year: record.‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ || '',
                    semester: record['‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤'] || '',
                    class: record.‡∏ä‡∏±‡πâ‡∏ô || '',
                    editDate: new Date().toLocaleDateString('th-TH'),
                    editTime: new Date().toLocaleTimeString('th-TH'),
                    timestamp: new Date().getTime()
                };

                console.log('Sending update data:', updateData);

                // Handle image upload
                if (imageFile) {
                    if (imageFile.size > 5 * 1024 * 1024) {
                        alert('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)');
                        saveBtn.disabled = false;
                        saveBtn.innerHTML = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
                        return;
                    }

                    try {
                        const base64Data = await fileToBase64(imageFile);
                        updateData.imageData = {
                            base64Data: base64Data,
                            fileName: imageFile.name,
                            mimeType: imageFile.type
                        };
                        console.log('Image data prepared for upload');
                    } catch (error) {
                        console.error('Error processing image:', error);
                        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û');
                        saveBtn.disabled = false;
                        saveBtn.innerHTML = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
                        return;
                    }
                }

                // Send POST request
                const response = await fetch(CONFIG.APP_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(updateData)
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                // Check response
                let result;
                if (response.ok) {
                    try {
                        result = await response.json();
                        console.log('Response data:', result);
                    } catch (error) {
                        console.log('Response is not JSON, assuming success');
                        result = { success: true, message: 'Data sent successfully' };
                    }
                } else {
                    const errorText = await response.text();
                    console.error('Response error:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                if (result.success !== false) {
                    // Update local data for immediate UI update
                    const originalIndex = allData.findIndex(row => row.rowIndex === record.rowIndex);
                    if (originalIndex !== -1) {
                        allData[originalIndex].New_Result = newResult;
                        allData[originalIndex].Correction_Status = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß';
                        allData[originalIndex].Editor = editor;
                        allData[originalIndex].EditDate = updateData.editDate;
                        allData[originalIndex].EditTime = updateData.editTime;
                    }
                    
                    filteredData[currentEditRow].New_Result = newResult;
                    filteredData[currentEditRow].Correction_Status = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß';
                    filteredData[currentEditRow].Editor = editor;
                    filteredData[currentEditRow].EditDate = updateData.editDate;
                    filteredData[currentEditRow].EditTime = updateData.editTime;
                    
                    // Show success message
                    alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß\n\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡πÅ‡∏•‡πâ‡∏ß');
                    
                    closeEditModal();
                    displayData(); // Update display immediately
                    
                    // Reload data from server to confirm changes
                    setTimeout(() => {
                        console.log('Reloading data to confirm changes...');
                        loadData();
                    }, 3000);
                } else {
                    throw new Error('Server returned error: ' + (result.message || 'Unknown error'));
                }
                
            } catch (error) {
                console.error('Error saving edit:', error);
                
                // Even if there's an error, update local data for better user experience
                const record = filteredData[currentEditRow];
                const originalIndex = allData.findIndex(row => row.rowIndex === record.rowIndex);
                if (originalIndex !== -1) {
                    allData[originalIndex].New_Result = newResult;
                    allData[originalIndex].Correction_Status = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß (‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô)';
                    allData[originalIndex].Editor = editor;
                    allData[originalIndex].EditDate = new Date().toLocaleDateString('th-TH');
                    allData[originalIndex].EditTime = new Date().toLocaleTimeString('th-TH');
                }
                
                filteredData[currentEditRow].New_Result = newResult;
                filteredData[currentEditRow].Correction_Status = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß (‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô)';
                filteredData[currentEditRow].Editor = editor;
                filteredData[currentEditRow].EditDate = new Date().toLocaleDateString('th-TH');
                filteredData[currentEditRow].EditTime = new Date().toLocaleTimeString('th-TH');
                
                // Show error message
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\n\n' + 
                      '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ' + error.message + '\n\n' +
                      '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\n' +
                      '‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï\n' +
                      '‚Ä¢ URL ‡∏Ç‡∏≠‡∏á Google Apps Script\n' +
                      '‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Google Sheets');
                closeEditModal();
                displayData(); // Update display with local changes
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
            }
        }

        // View log
        async function viewLog(index) {
            const record = filteredData[index];
            document.getElementById('logModal').classList.add('show');
            
            // Show loading state
            document.getElementById('logContent').innerHTML = `
                <div class="text-center text-gray-500">
                    <div class="loading mx-auto mb-2"></div>
                    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≤‡∏Å Google Sheets...
                </div>
            `;
            
            try {
                const studentName = `${record.‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ || ''} ${record.‡∏ä‡∏∑‡πà‡∏≠ || ''} ${record.‡∏™‡∏Å‡∏∏‡∏• || ''}`.trim();
                const url = CONFIG.APP_SCRIPT_URL + '?action=getLog&studentName=' + encodeURIComponent(studentName) + '&subjectCode=' + encodeURIComponent(record.‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤ || '') + '&rowIndex=' + encodeURIComponent(record.rowIndex || '') + '&t=' + new Date().getTime();
                
                console.log('Fetching edit log from Google Sheets:', url);
                
                const response = await fetch(url, {
                    method: 'GET',
                    redirect: 'follow'
                });

                console.log('Log response status:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Log result from Google Sheets:', result);
                
                if (result.success && result.data) {
                    const logData = result.data;
                    document.getElementById('logContent').innerHTML = `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-3">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≤‡∏Å Google Sheets</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ${logData.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç || logData.EditDate || '-'}</div>
                                <div><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${logData.‡πÄ‡∏ß‡∏•‡∏≤ || logData.EditTime || '-'}</div>
                                <div><strong>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> ${logData['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'] || logData.studentName || studentName}</div>
                                <div><strong>‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤:</strong> ${logData.‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤ || logData.subjectCode || record.‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤ || '-'}</div>
                                <div><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤:</strong> ${logData.‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ || logData.subjectName || record.‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ || '-'}</div>
                                <div><strong>‡∏ä‡∏±‡πâ‡∏ô:</strong> ${logData.‡∏ä‡∏±‡πâ‡∏ô || logData.class || record.‡∏ä‡∏±‡πâ‡∏ô || '-'}</div>
                                <div><strong>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏¥‡∏°:</strong> <span class="text-red-600 font-medium">${logData.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏¥‡∏° || logData.oldResult || record.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô || '-'}</span></div>
                                <div><strong>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà:</strong> <span class="text-green-600 font-medium">${logData.‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà || logData.newResult || record.New_Result || '-'}</span></div>
                                <div><strong>‡∏ú‡∏π‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ${logData.‡∏ú‡∏π‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç || logData.editor || record.Editor || '-'}</div>
                                <div><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ${logData.‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ || logData.note || '-'}</div>
                            </div>
                            ${(logData['‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á'] || logData.imageUrl) ? `
                                <div class="mt-4">
                                    <strong>‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á:</strong> 
                                    <a href="${logData['‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á'] || logData.imageUrl}" target="_blank" rel="noopener noreferrer" 
                                       class="text-blue-600 hover:text-blue-800 underline ml-2">‡∏î‡∏π‡∏†‡∏≤‡∏û</a>
                                </div>
                            ` : ''}
                            <div class="mt-4 p-3 bg-green-50 rounded-lg">
                                <p class="text-sm text-green-700">‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
                                <p class="text-xs text-green-600 mt-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å Sheet "Edit_Log" ‡πÉ‡∏ô Google Sheets</p>
                            </div>
                        </div>
                    `;
                } else {
                    // No log data found in Google Sheets
                    document.getElementById('logContent').innerHTML = `
                        <div class="text-center text-gray-500 p-8">
                            <div class="text-4xl mb-4">üìù</div>
                            <p class="text-lg mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô Google Sheets</p>
                            <p class="text-sm mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Sheet "Edit_Log"</p>
                            <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                                <p class="text-sm text-blue-700">üí° ‡∏´‡∏≤‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</p>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading log from Google Sheets:', error);
                
                document.getElementById('logContent').innerHTML = `
                    <div class="text-center text-red-500 p-8">
                        <div class="text-4xl mb-4">‚ùå</div>
                        <p class="text-lg mb-2">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏î‡πâ</p>
                        <p class="text-sm mb-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</p>
                        <div class="text-xs text-left bg-red-50 p-3 rounded-lg">
                            <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:</strong><br>
                            ${error.message}<br><br>
                            <strong>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong><br>
                            ‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï<br>
                            ‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏Ç‡∏≠‡∏á Google Apps Script<br>
                            ‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ Sheet "Edit_Log" ‡πÉ‡∏ô Google Sheets ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà<br>
                            ‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Google Sheets
                        </div>
                        <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                            <p class="text-sm text-yellow-700">‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏≤‡∏Å‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà</p>
                        </div>
                    </div>
                `;
            }
        }

        // Close log modal
        function closeLogModal() {
            document.getElementById('logModal').classList.remove('show');
        }

        // Utility functions
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        function showLoading() {
            document.getElementById('dataTable').innerHTML = `
                <tr>
                    <td colspan="10" class="px-4 py-8 text-center text-gray-500">
                        <div class="loading mx-auto mb-2"></div>
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                    </td>
                </tr>
            `;
        }

        function showError(message) {
            document.getElementById('dataTable').innerHTML = `
                <tr>
                    <td colspan="10" class="px-4 py-8 text-center text-red-500">
                        ‚ùå ${message}
                    </td>
                </tr>
            `;
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'991ddcba57e37325',t:'MTc2MTAxOTM3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
